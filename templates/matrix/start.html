{% extends 'base.html' %}

{% block extrahead %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Chart.js/0.2.0/Chart.min.js" type="text/javascript"></script>
{% endblock %}

{% load crispy_forms_tags %}
{% block content %}

<style>
    .headertitle {
        font-weight: bolder;
        font-size: 50px;
        margin-left: 0px;
        padding-left: 0px;
    }
    .subtitle {
        font-weight: bolder;
    }

    .gridwrap {
        display: grid;
        grid-template-columns:40% 60%;
    }

    /* styling */
    select {
        width:100%;
        border: 0px solid #bbb;
        box-shadow: 0 0px 1px 0 rgba(0,0,0,0.2);
        background-color:#DDDDDD;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-image:url(/static/dropdown.svg);
        background-position: right;
        background-size: 10px;
        background-repeat: no-repeat;

        margin: 1px;
    }
    input[type=number] {

        border: 0px solid #bbb;
        width: 100%;
        background-color:#DDDDDD;
        margin: 1px;
        box-sizing: border-box;
        border-radius: 4px;
        resize: none;
    }

    input[type=number] {
        -moz-appearance:textfield; /* Firefox */
    }

    input[type="checkbox"] + label::before {
        width: 15px;
        height: 15px;
        border-radius: 15px;
        border: 0px solid #8cad2d;
        background-color: #fff;
        display: block;
        content: "";
        float: left;
        margin-right: 5px;
    }

    input[type="checkbox"]:checked+label::before {
        box-shadow: inset 0px 0px 0px 3px #fff;
        background-color: #8cad2d;
    }

    select:hover {
        box-shadow: 0 1px 1px 0 rgba(0,0,0,0.1);
    }


</style>
<div class="container">
    <h1 class="title">App2</h1>
</div>


<!--
    Usecase tabs have to occur here and not in form tag,
    otherwise one gets csrf token error.
-->

<form class='container' action="" method="post">
    {% csrf_token %}
    <h4 class="subtitle">Konfiguration des Szenarios</h4>


    <!------------------------------------------------------------------->
    <!----------------- Konfiguration des Szenarios --------------------->
    <!------------------------------------------------------------------->
    <div class="gridwrap">
        <div class="label">Welche Jahreszeit soll betrachtet werden?</div> 
        <div class="value">{{form.jahreszeit}}</div>

        <div class="label">Welche KW soll dargestellt werden?</div>
        <div class="value">{{form.kalenderwoche}}</div>

        <div class="label">Welche Betriebsstrategie soll getestet werden?</div>
        <div class="value">{{form.betriebsstrategie}}</div>

        <div class="label">Welcher Use-Case soll betrachtet werden</div>
        <div class="value" id="parametrisierung">{{form.use_case}}</div>

        <div class="label">Regelleistungs-Check durchführen?</div>
        <div class="value">{{form.regelleistungscheck}}</div> 

        <div class="label">Zeitfenster (h)</div>
        <div class="value">{{ form.zeitfenster }}</div> 

        <p>Welche statischen Steuern und Umlagen sollen berücksichtigt werden (ct/kWh)?</p> <br>

        <div class="label">Netzentgelte</div>
        <div class="value">{{ form.netzentgelte }}</div> 

        <div class="label">EEG-Umlage</div>
        <div class="value">{{ form.eeg_umlage }}</div>


        <div class="label">Stromsteuer</div>
        <div class="value">{{ form.stromsteuer }}</div> 

        <div class="label">Konzessionsabgabe</div>
        <div class="value">{{ form.konzessionsabgabe }}</div> 

        <div class="label">Sonstige (z.B. KWK)</div>
        <div class="value">{{ form.sonstige }}</div> 


        <div class="label">Mehrwertsteuer berücksichtigen</div>
        <div class="value">{{ form.mehrwertsteuer_bool }}</div>

        <div class="label">Höhe der CO2-Steuer [€/t]</div>
        <div class="value" id="co2_steuer">{{ form.co2_steuer }}</div>
        <output for="co2_steuer" id="co2_steuer_value">{{ form.co2_steuer.data }}</output>
        <br>



        <div class="label">Dynamik der EEG-Umlage [%]</div>
        <div class="value">{{ form.dynamik_eeg_umlage }}</div>
        <output for="dynamik_eeg_umlage" id="dynamik_eeg_umlage_value">{{ form.dynamik_eeg_umlage.data }}</output>
        <br>


        <div class="label">Schwankungsbreite des Strompreises [%]</div>
        <div class="value">{{ form.schwankungsbreite_strompreis }}</div> 

        <div class="label">Gaspreis [ct/kWh]</div>
        <div class="value">{{ form.gaspreis }}</div> 

        <div class="label">Emissionen Gas [kg/MWh]</div>
        <div class="value">{{ form.emissionen_gas }}</div> 

    </div>


    <!------------------------------------------------------------------>
    <!--------------- Parametrierung des Use-Case "BHKW" --------------->
    <!------------------------------------------------------------------>

    <br>
    <div class="gridwrap">
        <div id="BHKW" class="gridwrap expandable tabcontent" style="display:none">
            <h4 class="subtitle">Parametrierung des Use-Case "BHKW"</h2>
            <h4>Technische Parameter BHKW</h4>

            <div class="label">Gesamtwirkungsgrad</div>
            <div class="value">{{ form.bhkw_gesamtwirkungsgrad }}</div>

            <div class="label">Wirkungsgrad bei maximaler Auslastung</div>
            <div class="value">{{ form.bhkw_wirkungsgrad_maximale_auslastung }}</div>

            <div class="label">Wirkungsgrad bei minimaler Auslastung</div>
            <div class="value">{{ form.bhkw_wirkungsgrad_minimale_auslastung }}</div>

            <div class="label">Thermische Trägheit</div>
            <div class="value">{{ form.bhkw_thermische_traegheit }}</div>

            <div class="label">Maximale elektrische Leistung</div>
            <div class="value">{{ form.bhkw_maximale_elektrische_leistung }} in kW</div>

            <div class="label">Minimale elektrische Leistung</div>
            <div class="value">{{ form.bhkw_minimale_elektrische_leistung }} in kW</div>

            <div class="label">Kosten pro Schaltvorgang</div>
            <div class="value">{{ form.bhkw_kosten_pro_schaltvorgang }} in ct</div>

            <div class="label">Fehler Anfahrenergie (negativer Wert)</div>
            <div class="value">{{ form.bhkw_fehler_anfahrenergie }} in kW</div>

            <h4>Technische Parameter Spitzenlastkessel</h4>

            <div class="label">Maximale Leistung</div>
            <div class="value">{{ form.bhkw_maximale_leistung }} in kW</div>

            <div class="label">Wirkungsgrad</div>
            <div class="value">{{ form.bhkw_wirkungsgrad }}</div> 

            <h4>Wärmespeicher</h4>

            <div class="label">maximale Leistung beim Einspeichern</div>
            <div class="value">{{ form.bhkw_max_leistung_einsspeichern }} in kW</div>

            <div class="label">maximale Leistung beim Ausspeichern</div>
            <div class="value">{{ form.bhkw_max_leistung_ausspeichern }} in kW</div>

            <div class="label">Maximaler Ladezustand</div>
            <div class="value">{{ form.bhkw_maximaler_ladezustand }} in kWh</div>

            <div class="label">Standby-Verluste des Wärmespeichers</div>
            <div class="value">{{ form.bhkw_standby_verluste_waermespeicher }} in kWh</div>

            <div class="label">Wärmeverlust im Speicher relativ zu Ladezustand</div>
            <div class="value">{{ form.bhkw_waermeverlust_relativ_ladezustand }} in %</div>

            <div class="label">Wirkungsgrad beim Einspeichern</div>
            <div class="value">{{ form.bhkw_wirkungsgrad_einspeichern }}</div> 

            <div class="label">Wirkungsgrad beim Ausspeichern</div>
            <div class="value">{{ form.bhkw_wirkungsgrad_ausspeichern }}</div> 

            <h4>Anfangsbedingungen</h4>

            <div class="label">Anfangszustand der BHKWs</div>
            <div class="value">{{ form.bhkw_anfangszustand }}</div> 

            <div class="label">Startwert der elektrischen Leistung</div>
            <div class="value">{{ form.bhkw_startwert_el_leistung }} in kW</div>

            <div class="label">Start-SOC</div>
            <div class="value">{{ form.bhkw_start_soc }} Startwert Speicherladezustand in %, SOC = State of Charge</div>

            <h4>Wärmebedarf für die Simulation</h4>
            {{ form.bhkw_konstanter_waermebedarf_bool }}

            <div class="label">Konstanter Wärmebedarf</div>
            <div class="value">{{ form.bhkw_konstanter_waermebedarf }} in kW</div>

            {{ form.bhkw_waermeverlauf_verwenden_bool }}

            <div class="label">Wärmeverlauf verwenden</div>
            <div class="value">{{ form.bhkw_waermeverlauf_verwenden }} Noch kein Wärmebedarf geladen... TODO</div>

            {{ form.bhkw_parameter_submit }}
        </div>
    </div>


    <!------------------------------------------------------------------>
    <!------------- Parametrierung des Use-Case "Bivalenz" ------------->
    <!------------------------------------------------------------------>

    <div class="gridwrap"
        <div id="Bivalenz" class="expandable tabcontent" style="display:none">
            <h2>Parametrierung des Use-Case "Bivalenz"</h2>
            <h4>Wärmebedarf</h4>
            {{ form.bivalenz_konstanter_waermebedarf_bool }}

            Konstanter Wärmebedarf
            {{ form.bivalenz_konstanter_waermebedarf }} 

            {{ form.bivalenz_waermeverlauf_verwenden_bool }}

            <div class="label">Wärmeverlauf verwenden</div>
            <div class="value">{{ form.bivalenz_waermeverlauf_verwenden }}</div> 

            {{ form.bivalenz_parameter_submit }}
        </div>
    </div>



    <!------------------------------------------------------------------>
    <!------------- Parametrierung des Use-Case "Hysterese" ------------>
    <!------------------------------------------------------------------>

    <div id="Hysterese-Allgemein" class="expandable tabcontent" style="display:none">
        <h2>Parametrierung des Use-Case "Hysterese"</h2>
        <h4>Technische Parameter</h4>
        <div class="label">Kapazität</div>
        <div class="value">{{ form.hysterese_kapazität }}</div> 

        <div class="label">Elektrische Leistung</div>
        <div class="value">{{ form.hysterese_elektrische_leistung }}</div> 

        <div class="label">Dynamische Verluste</div>
        <div class="value">{{ form.hysterese_dynamische_verluste }}</div> 

        <div class="label">Heizung/Kühlung</div>
        <div class="value">{{ form.hysterese_heizung_kuehlung }}</div> 

        <div class="label">Wirkungsgrad</div>
        <div class="value">{{ form.hysterese_wirkungsgrad }}</div> 

        <h4>Anfangsbedingungen</h4>
        <div class="label">Start-SOC</div>
        <div class="value">{{ form.hysterese_start_soc }}</div> 

        <h4>Wärmebedarf für die Simulation</h4>
        {{ form.hysterese_konstanter_waermebedarf_bool }}

        <div class="label">Konstanter Wärmebedarf</div>
        <div class="value">{{ form.hysterese_konstanter_waermebedarf }}</div> 

        {{ form.hysterese_waermeverlauf_verwenden_bool }}
        <div class="label">Wärmeverlauf verwenden</div>
        <div class="value">{{ form.hysterese_waermeverlauf_verwenden }}</div> 

        {{ form.hysterese_parameter_submit }}
    </div>

    <div class="gridwrap">
        <div class="label">Konfigurationsbeispiele:</div>
        <div class="value">{{ form.hysterese_beispiele }} </div>

        <div class="label">Welche Parameter sollen simuliert werden? </div>
        <div class="value">{{form.auswahl_parametrisierung}}</div> 

        <div class="label">Gesamtkosten [€]</div>
        <div class="value">{{ form.gesamtkosten }}</div> 

        <div class="label">Emissionen [t]</div>
        <div class="value">{{ form.emissionen }}</div> 

        {{ form.run_simulation }}
    </div>


    </div>
    <br><br>
    <a href="#section_plots">
        <input type="submit" value="RUN SIMULATION!" />
    </a>

</form>


<!-- Plots -->
<a id="section_plots">
    <h1>Plots</h1>
</a>
<canvas id="plot1" width="400" height="100"></canvas>
<canvas id="plot2" width="400" height="100"></canvas>
<canvas id="plot3" width="400" height="100"></canvas>
<canvas id="plot4" width="400" height="100"></canvas>

<script>
    // Show error alert
    var errors = "{{ plot_data.Fehler }}"
    if (errors) {
        alert("Fehler: " + errors);
    }

    function showScenario(evt, cityName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(cityName).style.display = "block";
        evt.currentTarget.className += " active";
    }
    $("#id_use_case").change(function() {
        <!-- alert(this.value); -->
            showScenario(this.value, this.value);
    });



    // Hides all parametrization views
    function clear_param() {
        document.getElementById("BHKW").style.display = "none";
        document.getElementById("Bivalenz").style.display = "none";
        document.getElementById("Hysterese-Allgemein").style.display = "none";
    }

    // Hide parametrization views at start
    clear_param();

    // Show default view "Bivalenz"
    // deprecated since switchging to tabs
    // document.getElementById("Bivalenz").style.display = "block";

    // Show parametrization view that gets selected in dropdown
    // hide all others
    // $('#parametrisierung').change( function() {
    //     clear_param();
    //     var x = $('#parametrisierung option:selected').text();
    //     document.getElementById(x).style.display = "block";
    // });

    // (Slider <-> Value-Label) bindings
    //$('#co2_steuer_value').change( function(event, ui) {
    //    this.innerHTML = "foobar";
    //});

    // Plot
    var ctx1 = document.getElementById('plot1').getContext('2d');
    var ctx2 = document.getElementById('plot2').getContext('2d');
    var ctx3 = document.getElementById('plot3').getContext('2d');
    var ctx4 = document.getElementById('plot4').getContext('2d');

    function clear_param() {
        document.getElementById("BHKW").style.display = "none";
        document.getElementById("Bivalenz").style.display = "none";
        document.getElementById("Hysterese-Allgemein").style.display = "none";
    }

    // Show default view "Bivalenz"
    document.getElementById("BHKW").style.display = "block";

    // Show parametrization view that gets selected in dropdown
    // hide all others
    // $('#parametrisierung').change( function() {
    //     clear_param();
    //     var x = $('#parametrisierung option:selected').text();
    //     document.getElementById(x).style.display = "block";
    // });


    //    // Plots
    //    var plot1 = new Chart(ctx1, {
    //        type: 'line',
    //        data: {
    //            labels: {{ plot_data.Verlauf_spezifische_Emissionen.0 }},
    //            datasets: [{
    //                label: 'Verlauf spezifischer Emissionen',
    //                data: {{ plot_data.Verlauf_spezifische_Emissionen.1 }},
    //                backgroundColor: 'rgba(50, 200, 132, 0.0)',
    //                borderColor: 'rgba(0, 99, 132, 1.0)',
    //                borderWidth: 2,
    //                pointBorderColor: 'rgba(0,0,0,0)',
    //                yAxisID: 'y-axis-1',
    //                }, {
    //                label: 'Strompreisverlauf',
    //                data: {{ plot_data.Strompreisverlauf }},
    //                backgroundColor: 'rgba(50, 200, 64, 0.0)' ,
    //                borderColor:  'rgba(50, 200, 64, 1)' ,
    //                borderWidth: 2,
    //                pointBorderColor: 'rgba(0,0,0,0)',
    //                yAxisID: 'y-axis-2',
    //                }]
    //        },
    //        options: {
    //            scales: {
    //                yAxes: [
    //                    {
    //                        type: 'linear',
    //                        display: true,
    //                        position: 'left',
    //                        id: 'y-axis-1',
    //                        ticks: { beginAtZero: true }
    //                    },
    //                    {
    //                        type: 'linear',
    //                        display: true,
    //                        position: 'right',
    //                        id: 'y-axis-2',
    //                        ticks: { beginAtZero: true },
    //                        gridLines: {
    //                            drawOnChartArea: false, // only want the grid lines for one axis to show up
    //                        },
    //                    },
    //                ]
    //            }
    //        }
    //    });
    //
    //    var plot2 = new Chart(ctx2, {
    //        type: 'line',
    //        data: {
    //            labels: {{ plot_data.Wärmebedarf.0 }},
    //            datasets: [{
    //                label: 'Wärmebedarf',
    //                data: {{ plot_data.Wärmebedarf.1 }},
    //                backgroundColor: 'rgba(50, 200, 132, 0.0)',
    //                borderColor: 'rgba(0, 99, 132, 1.0)',
    //                borderWidth: 2,
    //                pointBorderColor: 'rgba(0,0,0,0)',
    //                yAxisID: 'y-axis-1',
    //            }]
    //        },
    //        options: {
    //            scales: {
    //                yAxes: [
    //                    {
    //                        type: 'linear',
    //                        display: true,
    //                        position: 'left',
    //                        id: 'y-axis-1',
    //                        ticks: { beginAtZero: true }
    //                    },
    //                ]
    //            }
    //        }
    //    });
    //
    //
    //    var plot3 = new Chart(ctx3, {
    //        type: 'line',
    //        data: {
    //            labels: {{ plot_data.Lastgang_SOLL_el.0 }},
    //            datasets: [{
    //                label: 'Lastgang elektrisch',
    //                data: {{ plot_data.Lastgang_SOLL_el.1 }},
        //                backgroundColor: 'rgba(50, 200, 132, 0.0)',
        //                borderColor: 'rgba(0, 99, 132, 1.0)',
        //                borderWidth: 2,
        //                pointBorderColor: 'rgba(0,0,0,0)',
        //                yAxisID: 'y-axis-1',
        //            }]
    //        },
        //        options: {
            //            scales: {
                //                yAxes: [
                    //                    {
                        //                        type: 'linear',
                        //                        display: true,
                        //                        position: 'left',
                        //                        id: 'y-axis-1',
                        //                        ticks: { beginAtZero: true }
                        //                    },
                    //                ]
                //            }
            //        }
    //    });
    //
        //
        //    var plot4 = new Chart(ctx4, {
            //        type: 'line',
            //        data: {
                //            labels: {{ plot_data.Lastgang_SOLL_Gas_oder_SOC.0 }},
                //            datasets: [{
                    //                label: 'Lastgang Gas',
                    //                data: {{ plot_data.Lastgang_SOLL_Gas_oder_SOC.1 }},
                    //                backgroundColor: 'rgba(50, 200, 132, 0.0)',
                    //                borderColor: 'rgba(0, 99, 132, 1.0)',
                    //                borderWidth: 2,
                    //                pointBorderColor: 'rgba(0,0,0,0)',
                    //                yAxisID: 'y-axis-1',
                    //            }]
                //        },
            //        options: {
                //            scales: {
                    //                yAxes: [
                        //                    {
                            //                        type: 'linear',
                            //                        display: true,
                            //                        position: 'left',
                            //                        id: 'y-axis-1',
                            //                        ticks: { beginAtZero: true }
                            //                    },
                        //                ]
                    //            }
                //        }
            //    });




</script>

<!-- Show external page embedding -->
<!-- <embed src="http://synergie-projekt.de/technologiematrix/#" style="width:100%; height: 900px;"> -->


{% endblock content %}
